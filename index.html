<!DOCTYPE html>
<html lang="ur" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>World Status | ÙˆØ±Ù„Úˆ Ø³Ù¹ÛŒÙ¹Ø³</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module">
        // Firebase Imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

        // Your Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyCuABgGQJk82MYdhsSECDp8hhbwKqGlR4Q",
            authDomain: "status-world-b37dc.firebaseapp.com",
            projectId: "status-world-b37dc",
            storageBucket: "status-world-b37dc.firebasestorage.app",
            messagingSenderId: "236695793865",
            appId: "1:236695793865:web:1f7d5bcdb924869a409d18"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // Cloudinary Details
        const CLOUD_NAME = "dbvjv9rf3";
        const UPLOAD_PRESET = "Status_World";

        // Login Check (Filhal Anonymous login rakha hai taake app foran chale)
        signInAnonymously(auth).catch(err => console.error("Auth Error:", err));

        // --- UPLOAD FUNCTION ---
        window.uploadStatus = async () => {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            const btn = document.getElementById('uploadBtn');

            if (!file) return alert("Ù¾ÛÙ„Û’ Ú©ÙˆØ¦ÛŒ ÙØ§Ø¦Ù„ Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº!");

            btn.disabled = true;
            btn.innerText = "Ø§Ù¾Ù„ÙˆÚˆ ÛÙˆ Ø±ÛØ§ ÛÛ’...";

            const formData = new FormData();
            formData.append("file", file);
            formData.append("upload_preset", UPLOAD_PRESET);

            try {
                // Cloudinary Upload
                const res = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/auto/upload`, {
                    method: "POST",
                    body: formData
                });
                const data = await res.json();
                
                // Firebase Database Save
                await addDoc(collection(db, "statuses"), {
                    url: data.secure_url,
                    type: data.resource_type,
                    createdAt: serverTimestamp(),
                    userId: auth.currentUser.uid
                });

                alert("Ø³Ù¹ÛŒÙ¹Ø³ Ø§Ù¾Ù„ÙˆÚˆ ÛÙˆ Ú¯ÛŒØ§!");
                fileInput.value = "";
            } catch (err) {
                console.error(err);
                alert("Ø§Ù¾Ù„ÙˆÚˆ Ù…ÛŒÚº Ù…Ø³Ø¦Ù„Û ÛÙˆØ§!");
            } finally {
                btn.disabled = false;
                btn.innerText = "Ø³Ù¹ÛŒÙ¹Ø³ Ù„Ú¯Ø§Ø¦ÛŒÚº";
            }
        };

        // --- FETCH & SHOW STATUS (TikTok Style) ---
        const statusContainer = document.getElementById('statusContainer');
        const q = query(collection(db, "statuses"), orderBy("createdAt", "desc"));

        onSnapshot(q, (snapshot) => {
            statusContainer.innerHTML = "";
            snapshot.forEach((doc) => {
                const data = doc.data();
                const post = document.createElement('div');
                post.className = "h-screen w-full snap-start relative bg-black flex items-center justify-center border-b border-gray-800";
                
                if (data.type === "video") {
                    post.innerHTML = `<video src="${data.url}" class="h-full w-full object-contain" loop autoplay muted playsinline></video>`;
                } else {
                    post.innerHTML = `<img src="${data.url}" class="h-full w-full object-contain">`;
                }

                // UI Overlay (Like/Comment)
                const overlay = document.createElement('div');
                overlay.className = "absolute bottom-10 right-5 flex flex-col gap-5 text-white text-center";
                overlay.innerHTML = `
                    <div class="text-2xl">â¤ï¸</div>
                    <div class="text-2xl">ğŸ’¬</div>
                `;
                post.appendChild(overlay);
                statusContainer.appendChild(post);
            });
        });
    </script>
    <style>
        body, html { margin: 0; padding: 0; overflow: hidden; background: black; }
        .snap-container { height: 100vh; overflow-y: scroll; scroll-snap-type: y mandatory; }
    </style>
</head>
<body>

    <div class="fixed top-0 w-full z-50 bg-black/50 p-4 flex gap-2 items-center border-b border-white/10">
        <input type="file" id="fileInput" class="text-white text-sm" accept="image/*,video/*">
        <button id="uploadBtn" onclick="uploadStatus()" class="bg-blue-600 text-white px-4 py-1 rounded-full text-sm font-bold">Ø³Ù¹ÛŒÙ¹Ø³ Ù„Ú¯Ø§Ø¦ÛŒÚº</button>
    </div>

    <div id="statusContainer" class="snap-container">
        <div class="h-screen flex items-center justify-center text-white">Ù„ÙˆÚˆÙ†Ú¯...</div>
    </div>

</body>
</html>